<!DOCTYPE html>
<html>
<head>
    <title>Database Connection Test</title>
</head>
<body>
    <h1>Database Connection Test</h1>
    <button onclick="testConnection()">Test Database Connection</button>
    <div id="result"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
        
        const SUPABASE_URL = "https://troqkvnbdmovkxbthqan.supabase.co";
        const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyb3Frdm5iZG1vdmt4YnRocWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2OTEyNzcsImV4cCI6MjA3NDI2NzI3N30.-eqfHwhYBu6289Vtvh-blIUH_-33biFLvuldaoNei00";
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);
        
        window.testConnection = async function() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                // Test 1: Check if profiles table exists
                console.log('Testing profiles table...');
                const { data: profiles, error: profilesError } = await supabase
                    .from('profiles')
                    .select('*')
                    .limit(1);
                
                if (profilesError) {
                    resultDiv.innerHTML = `
                        <h3>❌ Profiles table error:</h3>
                        <p>${profilesError.message}</p>
                        <p>Code: ${profilesError.code}</p>
                        <p>Details: ${profilesError.details || 'No details'}</p>
                    `;
                    return;
                }
                
                // Test 2: Check if scans table exists
                console.log('Testing scans table...');
                const { data: scans, error: scansError } = await supabase
                    .from('scans')
                    .select('*')
                    .limit(1);
                
                if (scansError) {
                    resultDiv.innerHTML = `
                        <h3>❌ Scans table error:</h3>
                        <p>${scansError.message}</p>
                        <p>Code: ${scansError.code}</p>
                        <p>Details: ${scansError.details || 'No details'}</p>
                    `;
                    return;
                }
                
                resultDiv.innerHTML = `
                    <h3>✅ Database connection successful!</h3>
                    <p>Profiles table: OK</p>
                    <p>Scans table: OK</p>
                    <p>You can now use the application.</p>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>❌ Connection failed:</h3>
                    <p>${error.message}</p>
                `;
            }
        };
    </script>
</body>
</html>
